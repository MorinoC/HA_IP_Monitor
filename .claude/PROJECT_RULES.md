# 🤖 Claude AI 项目工作规则

> **重要**: 每次开始工作前，必须按顺序阅读以下文件！

---

## 📖 开始工作前的阅读顺序 (强制！)

### 第一步: 了解项目全局
```
1. 阅读 README.md
   - 了解项目目标和需求
   - 了解技术架构
   - 了解功能规格
```

### 第二步: 了解当前状态
```
2. 阅读 PROJECT_STATUS.md
   - 查看项目完成度
   - 查看已完成/未完成的文件
   - 查看已知问题
   - 查看下一步工作计划
```

### 第三步: 了解今日任务
```
3. 阅读最新的交接文件 HANDOFF_YYYY-MM-DD_vX.X.md
   - 查看昨天完成的工作
   - 查看今天的工作计划
   - 查看优先级和注意事项
   - 查看参考资料
```

---

## 🔄 标准工作流程

### 阶段1: 开始工作 (每次会话开始)

1. **阅读三个核心文件** (按上述顺序)
2. **确认今日目标**
   - 明确优先级
   - 理解任务依赖关系
3. **准备开发环境**
   - 检查Git状态
   - 确认分支正确

---

### 阶段2: 编码开发

1. **遵循代码规范**
   - Python代码注释使用日语
   - 用户交互使用中文
   - 代码风格遵循PEP8

2. **实时记录**
   - 记录重要决策
   - 记录遇到的问题
   - 记录解决方案

3. **频繁提交**
   - 完成一个小功能就commit
   - 使用清晰的commit message
   - 格式: `<type>: <description>`
     - feat: 新功能
     - fix: 修复
     - docs: 文档
     - refactor: 重构

---

### 阶段3: 工作结束 (每次会话结束或每天结束)

**⚠️ 以下步骤必须全部完成，缺一不可！**

#### 步骤1: 更新 PROJECT_STATUS.md
```markdown
必须更新的部分:
- [ ] "最近修改记录" - 添加今天的修改
- [ ] "已完成的文件" - 更新文件状态 (✅/🔄/⏳)
- [ ] "下一步工作" - 更新优先级
- [ ] "最后更新时间" - 更新日期时间
- [ ] "完成度" - 更新百分比
```

#### 步骤2: 更新 README.md
```markdown
必须更新的部分:
- [ ] "更新日志" 部分 - 添加今日变更
- [ ] "开发计划" 部分 - 更新任务状态 (☐ → ☑)
- [ ] "最后更新" - 更新日期
```

#### 步骤3: 管理交接文件
```bash
# 删除旧的交接文件
rm HANDOFF_<昨天日期>_v<旧版本>.md

# 创建新的交接文件
touch HANDOFF_<今天日期>_v<新版本>.md

# 文件命名规则:
# HANDOFF_YYYY-MM-DD_vX.X.md
# 例如: HANDOFF_2025-11-13_v0.2.md
```

#### 步骤4: 编写新交接文件
```markdown
必须包含的内容:
- [ ] 今日完成工作总结
- [ ] 新建/修改的文件列表
- [ ] 代码行数统计
- [ ] 当前项目状态
- [ ] 明天工作计划 (详细！)
- [ ] 已知问题和注意事项
- [ ] 参考资料和代码位置
- [ ] 检查清单
```

#### 步骤5: Git提交
```bash
# 添加所有修改
git add .

# 提交 (使用清晰的message)
git commit -m "feat: 实现XXX功能

- 新增 coordinator.py 实现数据协调器
- 新增 sensor.py 实现基础传感器
- 更新 __init__.py 集成协调器
- 更新项目文档

🤖 Generated with Claude Code
Co-Authored-By: Claude <noreply@anthropic.com>"

# 推送到远程
git push
```

---

## 📋 代码规范

### Python代码注释
```python
# ❌ 错误 (不要用中文)
def get_status():
    # 获取系统状态
    return status

# ✅ 正确 (使用日语)
def get_status():
    """システムステータスを取得"""
    # ステータスデータを返す
    return status
```

### 用户交互文字
```python
# ✅ 正确 (用户看到的使用中文)
logger.info("正在连接VPS服务器...")
raise ValueError("VPS地址无效")
```

### 文件头部注释
```python
"""
ファイル名: coordinator.py
説明: VPSデータ更新コーディネーター
作成日: 2025-11-12
最終更新: 2025-11-12
"""
```

---

## 🎯 优先级管理

### 任务优先级标记
- 🔥 **高优先级**: 本周必须完成，影响核心功能
- 📌 **中优先级**: 下周完成，重要但不紧急
- 📎 **低优先级**: 后续完成，优化和完善

### 决策原则
1. **先实现核心功能，后完善细节**
2. **先让它能跑起来，再优化性能**
3. **遇到阻塞立即记录，寻求帮助**

---

## 🐛 问题处理流程

### 遇到问题时

1. **记录问题**
   ```markdown
   - 问题描述
   - 出现场景
   - 错误信息
   - 已尝试的解决方案
   ```

2. **查找资料**
   - 项目内文档
   - Home Assistant官方文档
   - 相关代码示例

3. **实施解决**
   - 测试解决方案
   - 更新文档
   - 避免以后再犯

4. **更新状态**
   - 在 PROJECT_STATUS.md 记录
   - 在交接文件中说明

---

## 📊 质量检查清单

### 代码质量
- [ ] 代码符合PEP8规范
- [ ] 所有函数都有文档字符串
- [ ] 注释使用日语
- [ ] 错误处理完善
- [ ] 没有硬编码的敏感信息

### 文档质量
- [ ] README.md 已更新
- [ ] PROJECT_STATUS.md 已更新
- [ ] 新的交接文件已创建
- [ ] 代码注释清晰
- [ ] 示例代码正确

### Git提交
- [ ] Commit message清晰
- [ ] 没有提交临时文件
- [ ] 没有提交敏感信息
- [ ] 已push到远程仓库

---

## 🔐 安全规范

### 绝对不能提交的内容
- ❌ 真实的API Token
- ❌ SSH私钥
- ❌ 密码
- ❌ VPS真实IP地址（在公开仓库）
- ❌ .env文件

### 敏感信息处理
- ✅ 使用环境变量
- ✅ 使用配置模板
- ✅ .gitignore排除敏感文件
- ✅ 文档中使用示例值

---

## 📞 求助指南

### 何时需要用户确认
1. **重大架构变更**
2. **删除重要代码**
3. **修改核心配置**
4. **不确定的技术选择**

### 如何描述问题
```markdown
# 问题标题

## 背景
简要说明背景...

## 问题
具体问题是什么...

## 可选方案
1. 方案A: 优点 / 缺点
2. 方案B: 优点 / 缺点

## 建议
我建议使用方案A，因为...

## 需要确认
请确认是否采用方案A？
```

---

## 🎓 学习资源

### 必读文档
- [Home Assistant开发文档](https://developers.home-assistant.io/)
- [HACS集成指南](https://hacs.xyz/docs/publish/integration)
- [Python最佳实践](https://docs.python-guide.org/)

### 项目内参考
- `docs/project_structure.md` - 项目结构
- `custom_components/ha_ip_monitor/const.py` - 常量定义
- `remote_scripts/README.md` - VPS脚本说明

---

## ✅ 每日工作检查清单

### 🌅 早上开始工作
- [ ] 阅读 README.md
- [ ] 阅读 PROJECT_STATUS.md
- [ ] 阅读最新交接文件
- [ ] 确认今日目标
- [ ] 检查Git状态

### 💻 开发过程中
- [ ] 遵循代码规范
- [ ] 及时commit
- [ ] 记录问题和决策
- [ ] 测试代码功能

### 🌙 晚上结束工作
- [ ] 更新 PROJECT_STATUS.md
- [ ] 更新 README.md
- [ ] 删除旧交接文件
- [ ] 创建新交接文件
- [ ] Git commit并push
- [ ] 检查所有TODO是否完成

---

## 🚀 效率提升技巧

1. **使用TODO注释**
   ```python
   # TODO: 实现日志分析功能
   # FIXME: 修复连接超时问题
   # NOTE: 这里使用了特殊算法
   ```

2. **模块化开发**
   - 一次只做一件事
   - 函数保持简短
   - 降低耦合度

3. **增量开发**
   - 先实现基础版本
   - 测试通过后再优化
   - 不要一次做太多

---

## 📝 最后的话

**记住**:
- 📖 **阅读是第一步** - 理解比编码更重要
- 📝 **文档是核心** - 好的文档胜过好的代码
- 🔄 **交接是关键** - 让下一个AI无缝接手
- ✅ **检查是必须** - 完成前检查所有清单

**祝工作顺利！** 🎉

---

**文档版本**: v1.0
**创建日期**: 2025-11-12
**最后更新**: 2025-11-12
**适用对象**: 所有参与项目开发的Claude AI实例
